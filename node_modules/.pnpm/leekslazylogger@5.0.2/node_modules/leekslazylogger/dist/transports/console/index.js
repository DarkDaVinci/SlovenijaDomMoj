"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Transport_1 = __importDefault(require("../../Transport"));
const deep_merge_1 = __importDefault(require("@eartharoid/deep-merge"));
const defaults_1 = __importDefault(require("./defaults"));
const dtf_1 = __importDefault(require("@eartharoid/dtf"));
const leeks_js_1 = require("leeks.js");
const dtf = new dtf_1.default('en-GB');
class ConsoleTransport extends Transport_1.default {
    constructor(options = {}) {
        const merged = (0, deep_merge_1.default)(defaults_1.default, options);
        super({ level: merged.level });
        this.options = merged;
    }
    write(log) {
        var _a, _b, _c, _d, _e, _f, _g;
        const content = typeof this.options.format === 'function'
            ? this.options.format.call(this.options, log)
            : (0, leeks_js_1.short)(this.options.format)
                .replace(/{+ ?level ?}+/gm, log.level.name.toLowerCase())
                .replace(/{+ ?LEVEL ?}+/gm, log.level.name.toUpperCase())
                .replace(/{+ ?namespace ?}+/gm, (_b = (_a = log.namespace) === null || _a === void 0 ? void 0 : _a.toLowerCase()) !== null && _b !== void 0 ? _b : 'global')
                .replace(/{+ ?NAMESPACE ?}+/gm, (_d = (_c = log.namespace) === null || _c === void 0 ? void 0 : _c.toUpperCase()) !== null && _d !== void 0 ? _d : 'GLOBAL')
                .replace(/{+ ?file ?}+/gmi, (_e = log.file) !== null && _e !== void 0 ? _e : 'unknown')
                .replace(/{+ ?line ?}+/gmi, (_f = String(log.line)) !== null && _f !== void 0 ? _f : 'unknown')
                .replace(/{+ ?column ?}+/gmi, (_g = String(log.column)) !== null && _g !== void 0 ? _g : 'unknown')
                .replace(/{+ ?content ?}+/gmi, log.content)
                .replace(/{+ ?timestamp ?}+/gmi, typeof this.options.timestamp === 'function'
                ? this.options.timestamp(log.timestamp)
                : dtf.fill(this.options.timestamp, log.timestamp));
        console[log.level.type](content);
    }
}
exports.default = ConsoleTransport;
